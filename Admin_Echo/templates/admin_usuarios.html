{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Gerenciamento de Usuários</h1>
    <button type="button" class="btn btn-primary" id="btn-abrir-modal">
        Criar Novo Usuário
    </button>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Nome</th>
                <th scope="col">Nível</th>
                <th scope="col">Status</th>
                <th scope="col" class="text-end">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in usuarios %}
            <tr>
                <th scope="row">{{ usuario.id }}</th>
                <td>{{ usuario.nome }}</td>
                <td>{{ usuario.nivel }}</td>
                <td>
                    {% if usuario.status == 'ativo' %}
                        <span class="badge bg-success">Ativo</span>
                    {% else %}
                        <span class="badge bg-secondary">Inativo</span>
                    {% endif %}
                </td>
                <td class="text-end">
                    <!-- Formulário para Ativar/Inativar -->
                    <form action="{{ url_for('alternar_status_usuario', user_id=usuario.id) }}" method="POST" class="d-inline">
                        {% if usuario.status == 'ativo' %}
                            <button type="submit" class="btn btn-warning btn-sm">Inativar</button>
                        {% else %}
                            <button type="submit" class="btn btn-success btn-sm">Ativar</button>
                        {% endif %}
                    </form>

                    <!-- Formulário para Excluir -->
                    <form action="{{ url_for('excluir_usuario', user_id=usuario.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Tem certeza que deseja excluir este usuário? Esta ação não pode ser desfeita.');">
                        <button type="submit" class="btn btn-danger btn-sm">Excluir</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center">Nenhum usuário cadastrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal (Label) para Criar Usuário -->
<div id="user-modal" class="modal-overlay">
  <div class="modal-content">
    <span class="close-button" id="close-modal-button">&times;</span>
    <h3>Criar Novo Usuário</h3>
    <hr>
    <form action="{{ url_for('criar_usuario') }}" method="POST">
        <div class="mb-3">
            <label for="nome" class="form-label">Nome de Usuário</label>
            <input type="text" class="form-control" id="nome" name="nome" required>
        </div>
        <div class="mb-3">
            <label for="senha" class="form-label">Senha</label>
            <input type="password" class="form-control" id="senha" name="senha" required>
        </div>
        <div class="mb-3">
            <label for="nivel" class="form-label">Nível de Acesso</label>
            <select class="form-select" id="nivel" name="nivel" required>
                <option value="" disabled selected>Selecione o nível</option>
                <option value="Router">Router</option>
                <option value="Usuario">Usuario</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Salvar Usuário</button>
    </form>
  </div>
</div>

<script>
    // Lógica para abrir e fechar o modal
    const userModal = document.getElementById('user-modal');
    const btnOpenModal = document.getElementById('btn-abrir-modal');
    const btnCloseModal = document.getElementById('close-modal-button');

    btnOpenModal.onclick = function() {
        userModal.style.display = 'block';
    }
    btnCloseModal.onclick = function() {
        userModal.style.display = 'none';
    }
    window.onclick = function(event) {
        if (event.target == userModal) {
            userModal.style.display = 'none';
        }
    }
</script>
{% endblock %}
